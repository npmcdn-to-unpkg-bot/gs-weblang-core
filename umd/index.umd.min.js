!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.gsWeblangCore=e():t.gsWeblangCore=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports={grammar:n(3),parser:n(7),lexer:n(5),tokens:n(2),interpreter:n(4),context:n(1)}},function(t,e,n){var r=n(6),i=function(){var t=[],e=[],n=new r(9,9),i={};this.init=function(){n.init()},this.board=function(){return n},this.put=function(t,e){console.log("VARIABLE SET: ",t,"   ",e),i[t]=e},this.get=function(t){return i[t]},this.all=function(){return i},this.startContext=function(){t.push(i),i={}},this.stopContext=function(){i=t.pop()},this.pushBoard=function(){e.push(n),n=n.clone()},this.popBoard=function(){n=e.pop()},this.init()};t.exports=i},function(t,e){var n={WHILE:"while",IF:"if",ELSE:"else",SWITCH:"switch",REPEAT:"repeat",FUNCTION:"function",PROCEDURE:"procedure",PROGRAM:"program",PUT:"Poner",REMOVE:"Sacar",HAS_STONES:"hayBolitas",CAN_MOVE:"puedeMover",MOVE:"Mover",RETURN:"return",RED:"Rojo",BLUE:"Azul",BLACK:"Negro",GREEN:"Verde",TRUE:"True",NOT:"not",TO:"to",FALSE:"False",NORTH:"Norte",SOUTH:"Sur",EAST:"Este",WEST:"Oeste"};t.exports=n},function(t,e){function n(t,e,n,r){"use strict";function i(t,e,n){f.infix(t,e,function(t){var r=this;return this.left=t,this.right=f.expression(e),this.arity="binary",this.eval=function(t){return n(r.right.eval(t),r.left.eval(t))},this})}function o(){var t=[];if(")"!==f.token.id)for(;t.push(f.expression(0)),","===f.token.id;)f.advance(",");return f.advance(")"),t}function s(){var t=[];if(f.advance("("),")"!==f.token.id)for(;"name"!==f.token.arity&&f.error(f.token,"Expected a parameter name."),f.scope.define(f.token),t.push(f.token),f.advance(),","===f.token.id;)f.advance(",");return f.advance(")"),t}function a(){f.advance("(");var t=f.expression(0);return f.advance(")"),t}function u(){return"{"===f.token.id?f.block():[f.statement()]}var c=n,h=r,f=new t(e);return i("<",40,function(t,e){return e>t}),i("<=",40,function(t,e){return e>=t}),i(">",40,function(t,e){return t>e}),i(">=",40,function(t,e){return t>=e}),i("!=",40,function(t,e){return t!==e}),i("==",40,function(t,e){return t===e}),i("||",20,function(t,e){return t||e}),i("&&",20,function(t,e){return t&&e}),i("+",50,function(t,e){return t+e}),i("-",50,function(t,e){return t-e}),i("*",60,function(t,e){return t*e}),i("/",60,function(t,e){return t/e}),f.prefix(c.NOT,function(t){return h.negation(f.expression(60))}),f.symbol("(end)"),f.symbol(":"),f.symbol(")"),f.symbol("("),f.symbol("]"),f.symbol("}"),f.symbol(","),f.symbol("->"),f.symbol(c.ELSE),f.symbol(c.TO),f.constant(c.FALSE,!1),f.constant(c.TRUE,!0),f.constant(c.BLUE,0),f.constant(c.RED,1),f.constant(c.BLACK,2),f.constant(c.GREEN,3),f.constant(c.NORTH,[0,1]),f.constant(c.SOUTH,[0,-1]),f.constant(c.EAST,[1,0]),f.constant(c.WEST,[-1,0]),f.stmt(";",function(){return{separator:";"}}),f.infix("(",80,function(t){"name"!==t.arity&&f.error(t,t.value+" is not a routine");var e,n=o();return e=t.value[0].toUpperCase()===t.value[0]?h.procedureCall(t.value,function(){return f.scope.find(t.value)},n):h.functionCall(t.value,function(){return f.scope.find(t.value)},n)}),f.infixr(":=",10,function(t){return"."!==t.id&&"["!==t.id&&"name"!==t.arity&&f.error(t,"Bad lvalue."),h.assignment(t,f.expression(9))}),f.stmt(c.PUT,function(){return h.putStone(a())}),f.stmt(c.REMOVE,function(){return h.removeStone(a())}),f.stmt(c.MOVE,function(){return h.moveClaw(a())}),f.prefix(c.HAS_STONES,function(){return h.hasStone(a())}),f.prefix(c.CAN_MOVE,function(){return h.canMove(a())}),f.symbol("(literal)").nud=h.literal(),f.symbol("(name)").nud=h.variable(),f.stmt(c.IF,function(){f.advance("(");var t=f.expression(0);f.advance(")");var e=u(),n=null;return f.token.id===c.ELSE&&(f.scope.reserve(f.token),f.advance(c.ELSE),n=u()),h.conditional(t,e,n)}),f.stmt(c.SWITCH,function(){var t=a();f.token.id===c.TO&&f.advance(c.TO),f.advance("{");for(var e=[];;){var n=f.expression(0);f.advance("->");var r=u();if(e.push({"case":n,body:r}),"}"===f.token.id||!f.tokens.hasNext())break}return f.advance("}"),h["switch"](t,e)}),f.stmt(c.WHILE,function(){var t=a(),e=u();return h.conditionalRepetition(t,e)}),f.stmt(c.REPEAT,function(){var t=a(),e=u();return h.numericRepetition(t,e)}),f.stmt("{",function(){var t=f.statements();return f.advance("}"),t}),f.stmt("(",function(){var t=f.statements();return f.advance(")"),t}),f.root(c.PROGRAM,function(){return h.programDeclaration(f.block())}),f.root(c.FUNCTION,function(){f.newScope();var t=f.token;"name"===f.token.arity&&(f.scope.define(f.token),f.advance());var e=s(),n=u(),r=n.pop();r&&"return"===r.alias&&r.expression||f.error(t,"La función "+t.value+" debe terminar con un "+c.RETURN),f.scope.pop();var i=h.functionDeclaration(t,e,n,r.expression);return i.std=function(){return i},i}),f.root(c.PROCEDURE,function(){f.newScope();var t=f.token;"name"===f.token.arity&&(f.scope.define(f.token),f.advance());var e=s(),n=u();f.scope.pop();var r=h.procedureDeclaration(t,e,n);return r.std=function(){return r},r}),f.stmt(c.RETURN,function(){return";"!==f.token.id&&(this.alias="return",this.expression=a()),this}),h.rootProgram(f)}t.exports=n},function(t,e,n){function r(t,e){t=t||[];for(var n=0;n<t.length;n++)t[n].interpret(e)}function i(t,e,n){for(var r=0;r<n.parameters.length;r++)t.put(n.parameters[r].value,e[r].eval(t))}var o=n(1),s={arity:"statement"},a={conditional:function(t,e,n){var i=Object.create(s);return i.alias="conditional",i.condition=t,i.left=e,i.right=n,i.interpret=function(i){return r(t.eval(i)?e:n,i),i},i},literal:function(){return function(){var t=this;return this.eval=function(){return t.value},this}},variable:function(){return function(){var t=this;return this.eval=function(e){return e.get(t.value)},this}},conditionalRepetition:function(t,e){var n=Object.create(s);return n.alias="while",n.expression=t,n.body=e,n.interpret=function(n){for(;t.eval(n);)r(e,n);return n},n},numericRepetition:function(t,e){var n=Object.create(s);return n.alias="repeat",n.expression=t,n.body=e,n.interpret=function(n){for(var i=t.eval(n),o=0;i>=o;o++)r(e,n);return n},n},assignment:function(t,e){var n=Object.create(s);return n.alias=":=",n.arity="binary",n.variable=t,n.expression=e,n.assignment=!0,n.interpret=function(n){n.put(t.value,e.eval(n))},n},"switch":function(t,e){var n=Object.create(s);return n.alias="switch",n.value=t,n.cases=e,n.interpret=function(n){for(var i=t.eval(n),o=0;o<e.length;o++)console.log(i,"   ---   ",e[o]["case"].eval(n),i==e[o]["case"].eval(n),i===e[o]["case"].eval(n)),e[o]["case"].eval(n)===i&&(console.log(e[o].body," <<<<<< "),r(e[o].body,n));return n},n},procedureCall:function(t,e,n){var o=Object.create(s);return o.arity="routine",o.alias="ProcedureCall",o.name=t,o.parameters=n,o.interpret=function(t){return t.startContext(),i(t,n,e),r(e.body,t),t.stopContext(),t},o},functionCall:function(t,e,n){var o={};return o.alias="functionCall",o.name=t,o.eval=function(t){var o=e();t.startContext(),t.pushBoard(),o.parameters&&i(t,n,o),r(o.body,t);var s=o["return"].eval(t);return t.popBoard(),t.stopContext(),s},o},putStone:function(t){var e=Object.create(s);return e.alias="PutStone",e.color=t,e.interpret=function(e){return e.board().putStone(t.eval(e)),e},e},negation:function(t){var e={arity:"unary"};return e.alias="not",e.expression=t,e.eval=function(e){return!t.eval(e)},this},removeStone:function(t){var e=Object.create(s);return e.alias="RemoveStone",e.parameters=[t],e.interpret=function(e){return e.board().removeStone(t.eval(e)),e},e},moveClaw:function(t){var e=Object.create(s);return e.alias="MoveClaw",e.paramters=[t],e.interpret=function(e){return e.board().move(t.eval(e)),e},e},hasStone:function(t){var e={};return e.eval=function(e){return e.board().hasStone(t.eval(e))},e},canMove:function(t){var e={};return e.eval=function(e){return e.board().canMove(t.eval(e))},e},programDeclaration:function(t){var e=Object.create(s);return e.alias="program",e.body=t,e.interpret=function(e){return r(t,e),e},e},procedureDeclaration:function(t,e,n){return t.name=t.value,t.arity="routine",t.alias="procedureDeclaration",t.parameters=e,t.body=n,t.interpret=function(t){return t},t},functionDeclaration:function(t,e,n,r){return t.interpret=function(t){return t},t.name=t.value,t.arity="routine",t.alias="functionDeclaration",t.parameters=e,t.body=n,t["return"]=r,t},rootProgram:function(t){return t.interpret=function(t,e){var n,i=[];e=e||new o;for(var s=0;s<t.length;s++)"program"===t[s].alias?n=t[s]:i.push(t[s]);r(i,e),n.interpret(e)},t}};t.exports=a},function(t,e){function n(t,e){this.from=0,this.row=0,this.prefix=t||"!=-<>:|&",this.suffix=e||"=|&>",this.punctuators="+-*.:%|!?#&;,()<>{}[]=",this.i=0,this.buf=null,this.buflen=0}function r(t,e){return{error:e,on:t}}function i(t){return"\r"===t||"\n"===t}function o(t){return t>="0"&&"9">=t}function s(t){return t>="a"&&"z">=t||t>="A"&&"Z">=t||"_"===t||"$"===t}function a(t){return t>="a"&&"z">=t||t>="A"&&"Z">=t||t>="0"&&"9">=t||"_"===t||"$"===t}n.prototype.hasNext=function(){return this._skipNonTokens(),this.from<this.buflen},n.prototype.input=function(t){this.from=0,this.i=0,this.row=0,this.buf=t,this.buflen=t.length,this.current=null,this.nextChar=null};var u={IDENTIFIER:"name",OPERATOR:"operator",EOF:"eof",COMMENT:"comment",NUMBER:"number",NEWLINE:"newline"};n.prototype.next=function(){return this._skipNonTokens(),this._refreshCurrentAndNextChars(),this.from>=this.buflen?null:this._processIdentifier()?this._consume(u.IDENTIFIER):this._processOperator()?this._consume(u.OPERATOR):this._processNumber()?this._consume(u.NUMBER):this._processComment()?this._consume(u.COMMENT):this._processError()},n.prototype._make=function(t,e){return{type:t,value:e,from:this.from,to:this.i,row:this.row}},n.prototype._consume=function(t){var e=this.buf.substring(this.from,this.i),n=this._make(t,e);return this.from=this.i,n},n.prototype._refreshCurrentAndNextChars=function(){this.current=this.buf.charAt(this.from),this.nextChar=this.buf.charAt(this.from+1)},n.prototype._processOperator=function(){return this.punctuators.indexOf(this.current)>=0?(this.i=this.from+1,this._processMultiCharOperator(),!0):!1},n.prototype._processMultiCharOperator=function(){this.prefix.indexOf(this.current)>=0&&this.suffix.indexOf(this.nextChar)>=0&&this.i++},n.prototype._processNumber=function(){if(o(this.current)){for(this.i=this.from+1;this.i<this.buflen&&o(this.buf.charAt(this.i));)this.i++;return!0}return!1},n.prototype._processError=function(){return this.i=this.from+1,r("Unmatched token",this._consume("UNMATCHED"))},n.prototype._processIdentifier=function(){if(s(this.current)){for(this.i=this.from+1;this.i<this.buflen&&a(this.buf.charAt(this.i));)this.i++;return!0}return!1},n.prototype._skipNonTokens=function(){for(;this.from<this.buflen;){var t=this.buf.charAt(this.from);if(" "!==t&&"	"!==t&&"\r"!==t&&"\n"!==t)break;"\n"===t&&(this.row+=1),this.from++,this.i=this.from}},n.prototype._processComment=function(){var t=this.current+this.nextChar;return this._processSingleLineComment(t)||this._processMultiLineComment(t)},n.prototype._processSingleLineComment=function(t){if("//"===t){for(;this.i<this.buflen&&!i(this.buf.charAt(this.i));)this.i++;return!0}},n.prototype._processMultiLineComment=function(t){if("/*"===t){for(this.i=this.i+2;this.i<this.buflen&&"*"!==this.buf.charAt(this.i)&&"/"!==this.buf.charAt(this.i+1);)this.i++;return this.i=this.i+2,!0}return!1},t.exports=n},function(t,e){function n(t,e){this.x=0,this.y=0,this.sizeX=t,this.sizeY=e}n.blue=0,n.red=1,n.black=2,n.green=3,n.prototype.init=function(){this.table=[[],[],[],[]];for(var t=0;t<this.sizeX;t++){this.table[0][t]=[],this.table[1][t]=[],this.table[2][t]=[],this.table[3][t]=[];for(var e=0;e<this.sizeY;e++)this.table[0][t][e]=0,this.table[1][t][e]=0,this.table[2][t][e]=0,this.table[3][t][e]=0}},n.prototype.clone=function(){var t=new n(this.sizeX,this.sizeY);t.init();for(var e=0;e<this.table.length;e++)t.table[e]=this.table[e].slice();return t.x=this.x,t.y=this.y,t},n.prototype.putStone=function(t){this.table[t][this.x][this.y]+=1},n.prototype.removeStone=function(t){this.table[t][this.x][this.y]-=1},n.prototype.hasStone=function(t){return this.table[t][this.x][this.y]},n.prototype.canMove=function(t){var e=this.x+t[0],n=this.y+t[1];return e<this.sizeX&&e>=0&&n<this.sizeY&&n>=0},n.prototype.move=function(t){this.x+=t[0],this.y+=t[1]},n.prototype.printAscii=function(){for(var t=this.sizeX+"x"+this.sizeY+"\n",e=this.table[0],n=this.table[1],r=this.table[2],i=this.table[3],o=this.sizeY-1;o>=0;o--){for(var s=0;s<this.sizeX;s++)t+=e[s][o]||n[s][o]||r[s][o]||i[s][o]?"#":".";t+="\n"}return t},t.exports=n},function(t,e){function n(t){this.scope=null,this.token=null,this.tokens=t;var e=this,n={};this.error=function(t,e){var n={error:e,on:t};throw n};var r={nud:function(){e.error(this,"Undefined.")},led:function(){e.error(this,"Missing operator.")}},i=function(){return this},o={define:function(t){var n=this.def[t.value];return"object"==typeof n&&e.error(t,n.reserved?"Already reserved.":"Already defined."),this.def[t.value]=t,t.reserved=!1,t.nud=i,t.led=null,t.std=null,t.lbp=0,t.scope=e.scope,t},find:function(t){for(var e,r=this;;){if(e=r.def[t],e&&"function"!=typeof e)return r.def[t];if(r=r.parent,!r)return e=n[t],e&&"function"!=typeof e?e:n["(name)"]}},pop:function(){this.scope=this.parent},reserve:function(t){if("name"===t.arity&&!t.reserved){var e=this.def[t.value];if(e){if(e.reserved)return;"name"===e.arity&&t.error("Already defined.")}this.def[t.value]=t,t.reserved=!0}}};this.newScope=function(){var t=e.scope;return e.scope=Object.create(o),e.scope.def={},e.scope.parent=t,e.scope},this.symbol=function(t,e){var i=n[t];return e=e||0,i?e>=i.lbp&&(i.lbp=e):(i=Object.create(r),i.id=i.value=t,i.lbp=e,n[t]=i),i},this.expression=function(t){var n,r=e.token;for(this.advance(),n=r.nud();t<e.token.lbp;)r=e.token,this.advance(),n=r.led(n);return n},this.constant=function(t,r){var i=this.symbol(t);return i.nud=function(){return e.scope.reserve(this),this.value=n[this.id].value,this.arity="literal",this.eval=function(){return r},this},i.value=r,i},this.infix=function(t,n,r){var i=this.symbol(t,n);return i.led=r||function(t){return this.left=t,this.right=e.expression(n),this.arity="binary",this},i},this.infixr=function(t,n,r){var i=this.symbol(t,n);return i.led=r||function(t){return this.left=t,this.right=e.expression(n-1),this.arity="binary",this},i},this.prefix=function(t,n){var r=this.symbol(t);return r.nud=n||function(){return scope.reserve(this),this.left=e.expression(70),this.arity="unary",this},r},this.stmt=function(t,e){var n=this.symbol(t);return n.std=e,n},this.root=function(t,e){var n=this.symbol(t);return n.root=e,n},this.advance=function(t){var e,r,i,o,s=this.tokens;if(t&&this.token.id!==t&&this.error(this.token,'Se esperaba "'+t+'" pero se encontró '+this.token.value),!s.hasNext())return this.token=n["(end)"],this.token;i=s.next(),o=i.value,e=i.type,"name"===e?r=this.scope.find(o):"operator"===e?(r=n[o],r||this.error(i,"Unknown operator.")):"number"===e?(r=n["(literal)"],e="literal",o=parseInt(o,10)):this.error(i,"Unexpected token.");var a=Object.create(r);return a.from=i.from,a.row=i.row,a.to=i.to,a.value=o,a.arity=e,this.token=a,a},this.block=function(){var t=this.token;return this.advance("{"),t.std()},this.statement=function(){var t,n=this.token;return n.std?(this.advance(),e.scope.reserve(n),n.std()):(t=this.expression(0),t.assignment||"("===t.id||"routine"===t.arity||this.error(t,"Bad expression statement."),t)},this.rootDeclaration=function(){var t,n=this.token;return n.root?(this.advance(),e.scope.reserve(n),n.root()):(t=this.expression(0),t.assignment||"("===t.id||"routine"===t.arity||this.error(t,"Bad expression statement."),t)},this.statements=function(){for(var t,e=[];"}"!==this.token.id&&"(end)"!==this.token.id;){var n=this.token.from;t=this.statement(),t&&(t.from=n,this.token.from&&(t.to=this.token.from),e.push(t))}return 0===e.length?null:e},this.roots=function(){for(var t,e=[];"(end)"!==this.token.id;){var n=this.token.from;t=this.rootDeclaration(),t&&(t.from=n,this.token.from&&(t.to=this.token.from),e.push(t))}return 0===e.length?null:e},this.parseProgram=function(t){this.tokens.input(t),this.newScope(),this.advance();var e=this.roots();return this.advance("(end)"),this.scope.pop(),e},this.parse=function(t){this.tokens.input(t),this.newScope(),this.advance();var e=this.statements();return this.advance("(end)"),this.scope.pop(),e},this.parseExpression=function(t){this.tokens.input(t),this.newScope(),this.advance();var e=this.expression(0);return this.advance("(end)"),this.scope.pop(),e}}t.exports=n}])});
//# sourceMappingURL=index.umd.min.js.map